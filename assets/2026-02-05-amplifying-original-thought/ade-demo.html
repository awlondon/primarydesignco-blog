<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Anomaly Detection Engine (ADE) — Demo</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0f1115;
      color: #e6e8eb;
      margin: 0;
      padding: 2rem;
    }
    .container {
      max-width: 860px;
      margin: 0 auto;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }
    p {
      line-height: 1.6;
      color: #b7bcc5;
    }
    textarea {
      width: 100%;
      min-height: 180px;
      margin-top: 1.5rem;
      padding: 1rem;
      font-size: 1rem;
      background: #161a22;
      color: #e6e8eb;
      border: 1px solid #2a2f3a;
      border-radius: 8px;
      resize: vertical;
    }
    button {
      margin-top: 1rem;
      padding: 0.7rem 1.2rem;
      font-size: 0.95rem;
      background: #2f6bff;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: #2456cc;
    }
    .output {
      margin-top: 2rem;
      padding: 1.5rem;
      background: #161a22;
      border: 1px solid #2a2f3a;
      border-radius: 8px;
    }
    .metric {
      margin-bottom: 1rem;
    }
    .label {
      font-size: 0.85rem;
      text-transform: uppercase;
      color: #8f96a3;
      letter-spacing: 0.05em;
    }
    .value {
      font-size: 1.1rem;
      margin-top: 0.25rem;
    }
    .note {
      margin-top: 2rem;
      font-size: 0.85rem;
      color: #8f96a3;
    }
    .claim {
    padding: 0.6rem 0.75rem;
    margin-bottom: 0.75rem;
    border-radius: 6px;
    line-height: 1.45;
  }
  
  .claim.common {
    opacity: 0.55;
  }
  
  .claim.recombination {
    opacity: 0.85;
  }
  
  .claim.anomalous {
    opacity: 1;
    border-left: 3px solid #4f7cff;
    background: rgba(79, 124, 255, 0.06);
  }
  
  .claim-meta {
    font-size: 0.8rem;
    color: #8f96a3;
    margin-top: 0.25rem;
  }
  .claim.canonical {
  opacity: 0.4;
  font-style: italic;
 }
  </style>
</head>
<body>
  <div class="container">
    <h1>Anomaly Detection Engine (ADE)</h1>
    <p>
      This demo evaluates <strong>predictability</strong>, not truth. It decomposes your input,
      positions each component against prior art, and estimates where—if anywhere—your thinking
      departs meaningfully from existing knowledge.
    </p>
    
    <label style="display:block; margin-top:1rem; font-size:0.85rem; color:#8f96a3;">
      Domain lens
    </label>
    <select id="domain" style="margin-top:0.25rem; padding:0.4rem;">
      <option value="general">General</option>
      <option value="philosophy">Philosophy / Theory</option>
      <option value="science">Science / Engineering</option>
      <option value="design">Design / Creative</option>
      <option value="political">Political / Social</option>
    </select>

    <textarea id="input" placeholder="Type your hypothesis or idea..."></textarea>
    <button type="button" onclick="runADE()">Evaluate</button>

    <div id="output" class="output" style="display:none;">
      <div class="metric">
        <div class="label">Estimated Anomaly Score</div>
        <div class="value" id="score"></div>
      </div>
      <div class="metric">
        <div class="label">Interpretation</div>
        <div class="value" id="interpretation"></div>
      </div>
      <div class="metric">
        <div class="label">Lineage Signals</div>
        <div class="value" id="lineage"></div>
      </div>
    </div>

    <div class="note">
      This is a conceptual demonstration. No claims about correctness, usefulness, or truth are made.
      Scores reflect deviation under constraint, not merit.
    </div>
  </div>
<script>
  const DOMAIN_THRESHOLDS = {
    general:    { anomalous: 78, recombination: 58, common: 38 },
    philosophy:{ anomalous: 74, recombination: 54, common: 36 },
    science:   { anomalous: 82, recombination: 62, common: 42 },
    design:    { anomalous: 75, recombination: 55, common: 35 },
    political: { anomalous: 85, recombination: 65, common: 45 }
  };

  function splitClaims(text) {
    const sentences = text
      .replace(/([.!?])/g, "$1|")
      .split("|")
      .map(s => s.trim())
      .filter(Boolean);
  
    return sentences;
  }

  function analyzeClaim(claim, domain) {
    const words = claim.toLowerCase().split(/\W+/).filter(Boolean);
    const unique = new Set(words).size;

    const lengthScore = Math.min(claim.length / 200, 1);
    const densityScore = Math.min(unique / 25, 1);
    const structureScore = /because|therefore|if|but|however|rather than/i.test(claim) ? 0.15 : 0;
    const punctuationScore = /[:;()]/.test(claim) ? 0.1 : 0;

    const raw = 0.35 * lengthScore + 0.45 * densityScore + structureScore + punctuationScore;
    let score = Math.round(Math.min(raw, 1) * 100);

    // Prevent punchy one-liners from scoring as anomalous
    if (claim.length < 120) {
      score = Math.min(score, 75);
    }

    const uncertainty = Math.round(10 + (1 - raw) * 15);
    const t = DOMAIN_THRESHOLDS[domain];

    let category, suggestion;

    if (score >= t.anomalous) {
      category = "Structural deviation";
      suggestion = "Formalize this deviation into a testable or falsifiable claim.";
    } else if (score >= t.recombination) {
      category = "Recombination of known ideas";
      suggestion = "Identify which assumption is being altered or recombined.";
    } else if (score >= t.common) {
      category = "Common framing";
      suggestion = "Competent but expected. Try changing scale or constraint.";
    } else {
      category = "Highly canonical";
      suggestion = "Closely tracks standard discourse. Introduce a counterfactual.";
    }

    return { claim, score, uncertainty, category, suggestion };
  }

  function runADE() {
    const text = document.getElementById("input").value.trim();
    if (!text) return;

    const domain = document.getElementById("domain").value;
    const claims = splitClaims(text);
    const analyses = claims.map(c => analyzeClaim(c, domain));

    const avgScore = Math.round(
      analyses.reduce((s, a) => s + a.score, 0) / analyses.length
    );

    const t = DOMAIN_THRESHOLDS[domain];

    document.getElementById("score").innerText =
      `${avgScore} / 100 (±${Math.round(
        analyses.reduce((s, a) => s + a.uncertainty, 0) / analyses.length
      )})`;

    document.getElementById("interpretation").innerText =
      avgScore >= t.anomalous
        ? "Overall input shows significant conceptual deviation."
        : avgScore >= t.recombination
        ? "Overall input shows non-trivial synthesis."
        : avgScore >= t.common
        ? "Overall input is competent but expected."
        : "Overall input closely tracks canonical formulations.";

    document.getElementById("lineage").innerHTML = analyses
      .map(a => {
        const cls =
          a.category === "Structural deviation"
            ? "anomalous"
            : a.category === "Recombination of known ideas"
            ? "recombination"
            : a.category === "Highly canonical"
            ? "canonical"
            : "common";

        return `
          <div class="claim ${cls}">
            "${a.claim}"
            <div class="claim-meta">
              ${a.score} ± ${a.uncertainty} · ${a.category}<br/>
              ↳ ${a.suggestion}
            </div>
          </div>
        `;
      })
      .join("");

    document.getElementById("output").style.display = "block";
  }
</script>
</body>
</html>
