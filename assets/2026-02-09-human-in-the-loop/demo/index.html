<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sophisticated Particle Generator</title>
<style>
  body,html {
    margin:0; padding:0; height:100%; overflow:hidden; background:#111;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    color:#eee;
    user-select:none;
  }
  #app {
    height:100vh;
    display: flex;
    flex-direction: row;
  }
  #canvas {
    flex: 1;
    background: radial-gradient(circle at center, #222 0%, #111 90%);
    display: block;
  }
  #controls {
    width: 300px;
    background: #161616;
    padding: 20px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
  }
  #controls h2 {
    margin: 0 0 15px;
    font-weight: 600;
    color: #75c7ff;
    text-align: center;
  }
  label {
    font-size: 0.9rem;
    margin-top: 10px;
  }
  input[type=range], input[type=color], select {
    width: 100%;
    margin-top: 5px;
  }
  #stats {
    margin-top: auto;
    font-size: 0.85rem;
    color: #aaa;
    background: #222;
    padding: 10px;
    border-radius: 8px;
    text-align:center;
    user-select:none;
  }
  button, .preset-btn {
    margin-top: 10px;
    background: #2471ff;
    border:none;
    padding: 8px;
    color: white;
    font-weight: 600;
    border-radius: 6px;
    cursor:pointer;
    transition: background 0.3s;
  }
  button:hover, .preset-btn:hover {
    background: #4a90ff;
  }
  .preset-container {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-top: 10px;
    justify-content: center;
  }
  .preset-btn {
    flex: 1 0 48%;
    font-size: 0.8rem;
    padding: 6px 4px;
  }
  small {
    color: #666;
  }
</style>
</head>
<body>
<div id="app">
  <canvas id="canvas"></canvas>
  <div id="controls">
    <h2>Particles Control</h2>

    <label for="presetCategory">Preset Category</label>
    <select id="presetCategory">
      <option value="basic" selected>Basic</option>
      <option value="fireworks">Fireworks</option>
      <option value="space">Space</option>
      <option value="nature">Nature</option>
    </select>

    <label>Preset Selection</label>
    <div class="preset-container" id="presetSelection"></div>

    <label for="numParticles">Number of Particles <small>(max 1000)</small></label>
    <input type="range" id="numParticles" min="10" max="1000" step="1" value="300" />

    <label for="speed">Speed <small>(px/frame)</small></label>
    <input type="range" id="speed" min="0" max="10" step="0.1" value="2" />

    <label for="size">Particle Size <small>(px radius)</small></label>
    <input type="range" id="size" min="1" max="10" step="0.5" value="4" />

    <label for="shape">Shape</label>
    <select id="shape">
      <option value="circle" selected>Circle</option>
      <option value="triangle">Triangle</option>
      <option value="square">Square</option>
      <option value="star">Star</option>
    </select>

    <label for="colorStart">Color Start</label>
    <input type="color" id="colorStart" value="#75c7ff" />

    <label for="colorEnd">Color End</label>
    <input type="color" id="colorEnd" value="#1a1a1a" />

    <label for="gravity">Gravity</label>
    <input type="range" id="gravity" min="-0.2" max="0.2" step="0.01" value="0" />

    <div style="margin-top:10px; text-align:center;">
      <button id="toggleAnimation">Pause</button>
    </div>

    <label>Color Presets</label>
    <div class="preset-container" id="colorPresetsStatic">
      <button class="preset-btn" data-start="#ff6f61" data-end="#330000">Fire</button>
      <button class="preset-btn" data-start="#6fffb0" data-end="#003311">Forest</button>
      <button class="preset-btn" data-start="#ffd166" data-end="#663300">Sunset</button>
      <button class="preset-btn" data-start="#c1e1ec" data-end="#0c2340">Ocean</button>
    </div>

    <label>Extra Features</label>
    <button id="toggleTrail">Enable Motion Trail</button>
    <button id="toggleWind">Enable Wind</button>

    <div id="stats">
      <div>FPS: <span id="fps">0</span></div>
      <div>Particles: <span id="currentParticles">0</span></div>
    </div>
  </div>
</div>

<script>
(() => {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  let width, height;
  function resize() {
    width = window.innerWidth - 300;
    height = window.innerHeight;
    canvas.style.width = width + 'px';
    canvas.style.height = height + 'px';
    canvas.width = width * devicePixelRatio;
    canvas.height = height * devicePixelRatio;
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.scale(devicePixelRatio, devicePixelRatio);
  }
  window.addEventListener('resize', resize);
  resize();

  // Color lerp unchanged
  function lerpColor(c0, c1, t) {
    const c0R = parseInt(c0.substring(1,3),16);
    const c0G = parseInt(c0.substring(3,5),16);
    const c0B = parseInt(c0.substring(5,7),16);
    const c1R = parseInt(c1.substring(1,3),16);
    const c1G = parseInt(c1.substring(3,5),16);
    const c1B = parseInt(c1.substring(5,7),16);
    const R = Math.round(c0R + (c1R - c0R) * t);
    const G = Math.round(c0G + (c1G - c0G) * t);
    const B = Math.round(c0B + (c1B - c0B) * t);
    return `rgb(${R},${G},${B})`;
  }

  // Shape draw helpers unchanged (circle, square, triangle, star)
  function drawCircle(ctx, x, y, r) {
    ctx.beginPath();
    ctx.arc(x, y, r, 0, 2 * Math.PI);
    ctx.fill();
  }
  function drawSquare(ctx, x, y, r) {
    ctx.beginPath();
    ctx.rect(x-r, y-r, r*2, r*2);
    ctx.fill();
  }
  function drawTriangle(ctx, x, y, r) {
    ctx.beginPath();
    ctx.moveTo(x, y - r);
    ctx.lineTo(x + r * Math.sin(Math.PI/3), y + r/2);
    ctx.lineTo(x - r * Math.sin(Math.PI/3), y + r/2);
    ctx.closePath();
    ctx.fill();
  }
  function drawStar(ctx, x, y, r) {
    ctx.beginPath();
    const spikes = 5;
    const outerRadius = r;
    const innerRadius = r/2.5;
    let rot = Math.PI / 2 * 3;
    let cx = x;
    let cy = y;
    let step = Math.PI / spikes;

    ctx.moveTo(cx, cy - outerRadius);
    for(let i=0;i<spikes;i++){
      let x1 = cx + Math.cos(rot) * outerRadius;
      let y1 = cy + Math.sin(rot) * outerRadius;
      ctx.lineTo(x1, y1);
      rot += step;

      let x2 = cx + Math.cos(rot) * innerRadius;
      let y2 = cy + Math.sin(rot) * innerRadius;
      ctx.lineTo(x2, y2);
      rot += step;
    }
    ctx.lineTo(cx, cy - outerRadius);
    ctx.closePath();
    ctx.fill();
  }

  // Particle class unchanged but reset uses proper width, height for looping
  class Particle {
    constructor(width, height, size, speed, gravity, colorStart, colorEnd, shape){
      this.width = width;
      this.height = height;
      this.sizeBase = size;
      this.speedBase = speed;
      this.gravity = gravity;
      this.colorStart = colorStart;
      this.colorEnd = colorEnd;
      this.shape = shape;

      this.reset();
    }
    reset(){
      this.x = Math.random() * this.width;
      this.y = Math.random() * this.height;
      this.size = this.sizeBase * (0.6 + Math.random()*0.8);
      this.speedX = (Math.random()*2-1) * this.speedBase;
      this.speedY = (Math.random()*2-1) * this.speedBase;
      this.gravityForce = this.gravity;
      this.life = 100 + Math.random()*100;
      this.age = 0;
      this.rotation = Math.random() * Math.PI*2;
      this.rotationSpeed = (Math.random()*2-1)*0.02;
    }
    update(windForce=0) {
      this.age++;
      this.speedY += this.gravityForce;
      this.speedX += windForce;
      this.x += this.speedX;
      this.y += this.speedY;
      this.rotation += this.rotationSpeed;

      if(this.x < -this.size) this.x = this.width + this.size;
      else if(this.x > this.width + this.size) this.x = -this.size;
      if(this.y < -this.size) this.y = this.height + this.size;
      else if(this.y > this.height + this.size) this.y = -this.size;

      if(this.age > this.life) this.reset();
    }
    draw(ctx){
      const t = this.age / this.life;
      ctx.fillStyle = lerpColor(this.colorStart, this.colorEnd, t);
      ctx.save();
      ctx.translate(this.x, this.y);
      ctx.rotate(this.rotation);
      switch(this.shape){
        case 'circle': drawCircle(ctx, 0, 0, this.size); break;
        case 'square': drawSquare(ctx, 0, 0, this.size); break;
        case 'triangle': drawTriangle(ctx, 0, 0, this.size); break;
        case 'star': drawStar(ctx, 0, 0, this.size); break;
        default: drawCircle(ctx, 0, 0, this.size);
      }
      ctx.restore();
    }
  }

  // Setup presetCategories minimally for functionality
  const presetCategories = {
    basic: [
      {label:"Basic Float", shape:"circle", speed:"2", size:"4", gravity:"0", colorStart:"#75c7ff", colorEnd:"#1a1a1a"},
      {label:"Soft Glow", shape:"star", speed:"1.5", size:"6", gravity:"0", colorStart:"#ff9eff", colorEnd:"#221144"}
    ],
    fireworks: [
      {label:"Red Burst", shape:"star", speed:"6", size:"5", gravity:"0.05", colorStart:"#ff6f61", colorEnd:"#330000"},
      {label:"Blue Spark", shape:"triangle", speed:"8", size:"3", gravity:"-0.02", colorStart:"#6fffb0", colorEnd:"#003311"}
    ],
    space: [
      {label:"Cosmic Drift", shape:"circle", speed:"2.5", size:"3", gravity:"0", colorStart:"#c1e1ec", colorEnd:"#0c2340"},
      {label:"Starfield", shape:"star", speed:"4", size:"2", gravity:"0", colorStart:"#ffffff", colorEnd:"#555555"}
    ],
    nature: [
      {label:"Forest Dust", shape:"square", speed:"1", size:"4", gravity:"0", colorStart:"#6fffb0", colorEnd:"#003311"},
      {label:"Sunset Glow", shape:"circle", speed:"3", size:"5", gravity:"0.01", colorStart:"#ffd166", colorEnd:"#663300"}
    ]
  };

  let particles = [];
  let particleCount = 300;
  let particleSpeed = 2;
  let particleSize = 4;
  let gravity = 0;
  let shape = 'circle';
  let colorStart = '#ff9eff';
  let colorEnd = '#221144';
  let fpsElem = document.getElementById('fps');
  let currentParticlesElem = document.getElementById('currentParticles');
  let isRunning = true;
  let trailEnabled = true; // enable trail for dreamy effect
  let windEnabled = true;  // slight wind for swirling
  let windForce = 0;

  const inputNum = document.getElementById('numParticles');
  const inputSpeed = document.getElementById('speed');
  const inputSize = document.getElementById('size');
  const inputGravity = document.getElementById('gravity');
  const inputShape = document.getElementById('shape');
  const inputColorStart = document.getElementById('colorStart');
  const inputColorEnd = document.getElementById('colorEnd');
  const btnToggle = document.getElementById('toggleAnimation');
  const btnTrail = document.getElementById('toggleTrail');
  const btnWind = document.getElementById('toggleWind');
  const presetButtonsStatic = document.querySelectorAll('#colorPresetsStatic .preset-btn');
  const presetCategorySelect = document.getElementById('presetCategory');
  const presetSelectionContainer = document.getElementById('presetSelection');

  inputColorStart.value = '#ff9eff';
  inputColorEnd.value = '#221144';

  function fillPresetSelection(category){
    presetSelectionContainer.innerHTML = '';
    const presets = presetCategories[category] || [];
    for(const preset of presets){
      const btn = document.createElement('button');
      btn.className = 'preset-btn';
      btn.textContent = preset.label;
      btn.title = `Shape: ${preset.shape}, Speed: ${preset.speed}, Size: ${preset.size}, Gravity: ${preset.gravity}`;
      btn.dataset.shape = preset.shape;
      btn.dataset.speed = preset.speed;
      btn.dataset.size = preset.size;
      btn.dataset.gravity = preset.gravity;
      btn.dataset.colorStart = preset.colorStart;
      btn.dataset.colorEnd = preset.colorEnd;
      btn.onclick = () => {
        shape = btn.dataset.shape;
        particleSpeed = parseFloat(btn.dataset.speed);
        particleSize = parseFloat(btn.dataset.size);
        gravity = parseFloat(btn.dataset.gravity);
        colorStart = btn.dataset.colorStart;
        colorEnd = btn.dataset.colorEnd;
        inputShape.value = shape;
        inputSpeed.value = particleSpeed;
        inputSize.value = particleSize;
        inputGravity.value = gravity;
        inputColorStart.value = colorStart;
        inputColorEnd.value = colorEnd;
        particles.forEach(p => {
          p.shape = shape;
          p.speedBase = particleSpeed;
          p.gravityForce = gravity;
          p.sizeBase = particleSize;
          p.colorStart = colorStart;
          p.colorEnd = colorEnd;
          p.speedX = (Math.random()*2-1)*particleSpeed;
          p.speedY = (Math.random()*2-1)*particleSpeed;
          p.size = particleSize*(0.6 + Math.random()*0.8);
        });
      };
      presetSelectionContainer.appendChild(btn);
    }
  }
  presetCategorySelect.onchange = () => {
    fillPresetSelection(presetCategorySelect.value);
  };
  fillPresetSelection(presetCategorySelect.value);

  function recreateParticles() {
    particles = [];
    for(let i=0;i<particleCount;i++){
      particles.push(new Particle(width, height, particleSize, particleSpeed, gravity, colorStart, colorEnd, shape));
    }
  }

  inputNum.oninput = () => {
    particleCount = Math.min(1000, Math.max(10, +inputNum.value));
    recreateParticles();
  }
  inputSpeed.oninput = () => {
    particleSpeed = +inputSpeed.value;
    particles.forEach(p=>{
      p.speedBase = particleSpeed;
      p.speedX = (Math.random()*2-1)*particleSpeed;
      p.speedY = (Math.random()*2-1)*particleSpeed;
    });
  }
  inputSize.oninput = () => {
    particleSize = +inputSize.value;
    particles.forEach(p=>{
      p.sizeBase = particleSize;
      p.size = particleSize * (0.6 + Math.random()*0.8);
    });
  }
  inputGravity.oninput = () => {
    gravity = +inputGravity.value;
    particles.forEach(p=>{
      p.gravityForce = gravity;
    });
  }
  inputShape.onchange = () => {
    shape = inputShape.value;
    particles.forEach(p=>p.shape = shape);
  }
  inputColorStart.oninput = () => {
    colorStart = inputColorStart.value;
    particles.forEach(p=>{
      p.colorStart = colorStart;
    });
  }
  inputColorEnd.oninput = () => {
    colorEnd = inputColorEnd.value;
    particles.forEach(p=>{
      p.colorEnd = colorEnd;
    });
  }
  btnToggle.onclick = () => {
    isRunning = !isRunning;
    btnToggle.textContent = isRunning ? "Pause" : "Play";
    if(isRunning) {
      lastFrameTime = performance.now();
      loop();
    }
  }
  btnTrail.onclick = () => {
    trailEnabled = !trailEnabled;
    btnTrail.textContent = trailEnabled ? "Disable Motion Trail" : "Enable Motion Trail";
  }
  btnWind.onclick = () => {
    windEnabled = !windEnabled;
    btnWind.textContent = windEnabled ? "Disable Wind" : "Enable Wind";
    windForce = 0;
  }
  presetButtonsStatic.forEach(btn => {
    btn.onclick = () => {
      colorStart = btn.getAttribute('data-start');
      colorEnd = btn.getAttribute('data-end');
      inputColorStart.value = colorStart;
      inputColorEnd.value = colorEnd;
      particles.forEach(p=>{
        p.colorStart = colorStart;
        p.colorEnd = colorEnd;
      });
    }
  });

  recreateParticles();

  let lastFrameTime = performance.now();
  let frames = 0;
  let fps = 0;
  let fpsUpdateInterval = 500;
  let lastFpsUpdate = performance.now();

  // Store original speed and count for drag temporary change
  let origSpeed = particleSpeed;
  let origCount = particleCount;
  let dragActive = false;

  canvas.addEventListener('mousedown', (e) => {
    dragActive = true;
    origSpeed = particleSpeed;
    origCount = particleCount;
  });

  canvas.addEventListener('mouseup', (e) => {
    if(dragActive){
      dragActive = false;
      // Restore inputs and parameters
      particleSpeed = origSpeed;
      particleCount = origCount;
      inputSpeed.value = origSpeed;
      inputNum.value = origCount;
      recreateParticles();
    }
  });

  canvas.addEventListener('mouseleave', (e) => {
    if(dragActive){
      dragActive = false;
      particleSpeed = origSpeed;
      particleCount = origCount;
      inputSpeed.value = origSpeed;
      inputNum.value = origCount;
      recreateParticles();
    }
  });

  canvas.addEventListener('mousemove', (e) => {
    if(!dragActive) return;
    let ratioX = e.offsetX / width;
    let ratioY = e.offsetY / height;

    let newSpeed = Math.min(10, Math.max(0, 10 * ratioX));
    let newCount = Math.round(10 + 990 * ratioY);

    if(Math.abs(newSpeed - particleSpeed) > 0.01 || newCount !== particleCount){
      particleSpeed = newSpeed;
      particleCount = newCount;
      inputSpeed.value = newSpeed.toFixed(2);
      inputNum.value = newCount;
      recreateParticles();
    }
  });

  function loop(t=performance.now()){
    if(!isRunning) return;
    requestAnimationFrame(loop);

    const dt = t - lastFrameTime;
    lastFrameTime = t;
    frames++;

    if(t - lastFpsUpdate > fpsUpdateInterval){
      fps = Math.round(frames * 1000 / (t - lastFpsUpdate));
      lastFpsUpdate = t;
      frames = 0;
      fpsElem.textContent = fps;
      currentParticlesElem.textContent = particles.length;
    }

    if(!trailEnabled){
      ctx.clearRect(0, 0, width, height);
    } else {
      ctx.fillStyle = 'rgba(34,17,68,0.12)';
      ctx.fillRect(0,0,width,height);
    }

    if(windEnabled){
      windForce = Math.sin(t/800)*0.03 + Math.cos(t/1200)*0.02;
    } else {
      windForce = 0;
    }

    for(let p of particles){
      p.update(windForce);
      p.draw(ctx);
    }
  }
  loop();
})();
</script>
</body>
</html>
